!function(){"use strict";class t{constructor(e,s,i,n){this.ticketsWrapper=document.querySelector(".tickets"),this.id=e,this.name=s,this.status=i,this.created=n;const a=t.formatDate(this.created);let c;const d=document.createElement("div");return d.classList.add("ticket"),d.dataset.id=this.id,c="true"===this.status||!0===this.status?"checked":"",d.innerHTML=`\n    <div class="ticket-view">\n      <label class="ticket-label">\n        <input type="checkbox" class="ticket-checkbox" ${c}>\n        <span class="ticket-span"></span>\n      </label>\n      <div class="ticket-content">\n        <div class="ticket-name">${this.name}</div>\n      </div>\n    </div>\n    <div class="ticket-created">${a}</div>\n    <div class="ticket-control">\n      <button type="button" class="edit-btn">&#9998</button>\n      <button type="button" class="delete-btn">X</button>\n    </div>`,d}static formatDate(t){const e=new Date(t);let s=e.getDate(),i=e.getMonth();const n=e.getFullYear();let a=e.getHours(),c=e.getMinutes();return s=s<10?`0${s}`:s,i=i<10?`0${i+1}`:`${i+1}`,a=a<10?`0${a}`:a,c=c<10?`0${c}`:c,`${s}.${i}.${n} ${a}:${c}`}}class e{constructor(t="http://localhost:7070/"){this.server=t}allTickets(){return new Promise(((t,e)=>{const s=new XMLHttpRequest;s.open("GET",`${this.server}?method=allTickets`),s.addEventListener("load",(()=>{if(s.status>=200&&s.status<300)try{const e=JSON.parse(s.response);t(e)}catch(t){e(t)}})),s.send()}))}ticketById(t){return new Promise(((e,s)=>{const i=new XMLHttpRequest;(new URLSearchParams).append("id",t),i.open("GET",`${this.server}?method=ticketById&id=${t}`),i.addEventListener("load",(()=>{if(i.status>=200&&i.status<300)try{const t=JSON.parse(i.response);e(t)}catch(t){s(t)}})),i.send()}))}createTicket(t,e){return new Promise(((s,i)=>{const n=new URLSearchParams;n.append("name",t),n.append("description",e);const a=new XMLHttpRequest;a.open("POST",`${this.server}?method=createTicket`),a.addEventListener("load",(()=>{if(a.status>=200&&a.status<300)try{const t=JSON.parse(a.response);s(t)}catch(t){i(t)}})),a.send(n)}))}removeById(t){return new Promise(((e,s)=>{const i=new XMLHttpRequest;(new URLSearchParams).append("id",t),i.open("DELETE",`${this.server}?method=removeById&id=${t}`),i.addEventListener("load",(()=>{if(i.status>=200&&i.status<300)try{const t=JSON.parse(i.response);e(t)}catch(t){s(t)}})),i.send()}))}editTicket(t,e,s){return new Promise(((i,n)=>{const a=new XMLHttpRequest,c=new URLSearchParams;c.append("id",t),c.append("name",e),c.append("description",s),a.open("POST",`${this.server}?method=editTicket&id=${t}`),a.addEventListener("load",(()=>{if(a.status>=200&&a.status<300)try{const t=JSON.parse(a.response);i(t)}catch(t){n(t)}})),a.send(c)}))}checkTicket(t,e){return new Promise(((s,i)=>{const n=new XMLHttpRequest,a=new URLSearchParams;a.append("id",t),a.append("status",e),n.open("POST",`${this.server}?method=checkTicket&id=${t}`),n.addEventListener("load",(()=>{if(n.status>=200&&n.status<300)try{const t=JSON.parse(n.response);s(t)}catch(t){i(t)}})),n.send(a)}))}}class s{constructor(t){this.parentEl=t,this.modal=document.createElement("div"),this.request=new e}drawModal(t){this.modal.classList.add("modal"),"addTicket"===t?(this.modal.classList.add("modal-handler"),this.modal.innerHTML='\n            <form class="modal-form" method ="POST" action ="http://localhost:7070">\n                <h2 class="modal-title">Добавить тикет</h2>\n                <label class="label-container">\n                    <span class="input-title">Краткое описание</span>\n                    <input class="input-name" type="text" required>\n                </label>\n                <label class="label-container">\n                    <span class="input-title">Подробное описание</span>\n                    <textarea class="input-description" type="text" required></textarea>\n                </label>\n                <div class="btn-box">\n                    <button class="cancel-btn" type="button">Отмена</button>\n                    <button class="ok-btn" type="submit">Ок</button>\n                </div>\n            </form>',this.name=this.modal.querySelector(".input-name"),this.description=this.modal.querySelector(".input-description"),this.name.value="",this.description.value=""):"editTicket"===t&&(this.modal.classList.add("modal-handler"),this.modal.innerHTML='\n            <form class="modal-form" method ="POST" action ="http://localhost:7070">\n                <h2 class="modal-title">Изменить тикет</h2>\n                <label class="label-container">\n                    <span class="input-title">Краткое описание</span>\n                    <input class="input-name" type="text" required>\n                </label>\n                <label class="label-container">\n                    <span class="input-title">Подробное описание</span>\n                    <textarea class="input-description" type="text" required></textarea>\n                </label>\n                <div class="btn-box">\n                    <button class="cancel-btn" type="button">Отмена</button>\n                    <button class="ok-btn" type="submit">Ок</button>\n                </div>\n            </form>'),this.parentEl.append(this.modal),this.activeModal=document.querySelector(".modal-handler"),this.activeModal.style.top=(window.innerHeight-this.activeModal.offsetHeight)/2+"px",this.activeModal.style.left=(window.innerWidth-this.activeModal.offsetWidth)/2+"px"}modalHandler(t){this.name=this.modal.querySelector(".input-name"),this.description=this.modal.querySelector(".input-description"),this.form=this.modal.querySelector(".modal-form"),this.cancelBtn=this.modal.querySelector(".cancel-btn"),this.cancelBtn.addEventListener("click",(t=>this.closeModal(t))),this.form.addEventListener("submit",t)}closeModal(t){t.preventDefault(),this.activeModal.remove()}}class i{constructor(t){this.parentEl=t,this.modal=document.createElement("div")}init(){this.modal.classList.add("modal","delete-modal","hidden"),this.modal.innerHTML='\n        <h2 class="modal-title">Удалить тикет</h2>\n        <div class="modal-text">Вы уверены, что хотите удалить тикет? Это действие необратимо.</div>\n        <div class="btn-box">\n          <button class="del-cancel-btn" type="button">Отмена</button>\n          <button class="del-ok-btn" type="submit">Ок</button>\n        </div>',this.parentEl.append(this.modal),this.deleteModal=document.querySelector(".delete-modal"),this.cancelDelBtn=this.modal.querySelector(".del-cancel-btn"),this.okDelBtn=this.modal.querySelector(".del-ok-btn")}openDeleteModal(){this.deleteModal.classList.remove("hidden"),this.deleteModal.style.top=(window.innerHeight-this.deleteModal.offsetHeight)/2+"px",this.deleteModal.style.left=(window.innerWidth-this.deleteModal.offsetWidth)/2+"px",this.cancelDelBtn.addEventListener("click",(()=>this.closeDeleteModal()))}closeDeleteModal(){this.deleteModal.classList.add("hidden")}}const n=new class{constructor(){this.container=null,this.ticketsWrapper=document.querySelector(".tickets"),this.modal=new s(document.body),this.deleteModal=new i(document.body,this.modal),this.id=null,this.addBtn=document.querySelector(".add-btn"),this.request=new e,this.addTicket=this.addTicket.bind(this),this.editTicket=this.editTicket.bind(this),this.checkTicket=this.checkTicket.bind(this),this.ticketActions=this.ticketActions.bind(this),this.tickets=[]}bindToDOM(t){if(!(t instanceof HTMLElement))throw new Error('Контейнер не "HTMLElement"');this.container=t}init(){this.deleteModal.init(),this.delOkBtn=document.querySelector(".del-ok-btn"),this.renderAllTickets(),this.addBtn.addEventListener("click",(t=>{t.preventDefault(),this.modal.drawModal("addTicket"),this.modal.modalHandler(this.addTicket)})),this.delOkBtn.addEventListener("click",(t=>{t.preventDefault(),this.deleteTicket(this.id)}))}renderAllTickets(){this.request.allTickets().then((e=>{this.tickets=[],this.ticketsWrapper.innerHTML="",e.forEach((e=>{const s=new t(e.id,e.name,e.status,e.created);this.tickets.push(s)}));for(const t of this.tickets)this.ticketsWrapper.append(t)})),this.ticketsWrapper.addEventListener("click",this.ticketActions)}ticketActions(t){t.preventDefault();const e=t.target.closest(".ticket");if(this.id=e.dataset.id,t.target.classList.contains("delete-btn")&&this.deleteModal.openDeleteModal(),t.target.classList.contains("edit-btn")&&(this.request.ticketById(this.id).then((t=>{this.modal.modal.querySelector(".input-name").value=t.name,this.modal.modal.querySelector(".input-description").value=t.description})),this.modal.drawModal("editTicket"),this.modal.modalHandler(this.editTicket)),t.target.classList.contains("ticket-name")||t.target.classList.contains("ticket-description")){const t=e.querySelector(".ticket-description");t?t.remove():this.request.ticketById(this.id).then((t=>{const s=document.createElement("div");s.classList.add("ticket-description"),s.innerText=t.description,e.querySelector(".ticket-content").append(s)}))}(t.target.classList.contains("ticket-span")||t.target.classList.contains("ticket-checkbox"))&&(e.querySelector(".ticket-checkbox").checked?this.status=!1:this.status=!0,this.checkTicket(this.id,this.status))}addTicket(t){t.preventDefault(),this.request.createTicket(this.modal.name.value,this.modal.description.value).then((()=>{this.renderAllTickets()})),this.modal.closeModal(t)}deleteTicket(t){this.deleteModal.closeDeleteModal(),this.request.removeById(t).then((()=>{this.renderAllTickets()}))}editTicket(t){t.preventDefault(),this.request.editTicket(this.id,this.modal.name.value,this.modal.description.value).then((()=>{this.renderAllTickets()})),this.modal.closeModal(t)}checkTicket(t){this.request.checkTicket(t,this.status).then((()=>{this.renderAllTickets()}))}},a=document.querySelector(".container");n.bindToDOM(a),n.init()}();
//# sourceMappingURL=main.js.map